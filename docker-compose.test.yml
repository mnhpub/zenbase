version: '3.8'

# Test Environment Docker Compose Override
# Use with: docker-compose -f docker-compose.yml -f docker-compose.test.yml up

services:
  backend:
    environment:
      - NODE_ENV=test
      - SUPABASE_URL=http://supabase-mock:3001
    command: npm test

  frontend:
    environment:
      - NODE_ENV=test
      - VITE_API_URL=http://backend:3000
    command: npm test

  # Mock Supabase for testing
  supabase-mock:
    image: node:20-alpine
    container_name: zenbase-supabase-mock
    ports:
      - "3001:3001"
    networks:
      - zenbase-network
    command: |
      sh -c "
        echo 'Mock Supabase server for testing'
        while true; do sleep 3600; done
      "
